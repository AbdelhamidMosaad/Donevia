// src/lib/firebase-admin.ts
import { App, initializeApp, cert, getApps } from 'firebase-admin/app';
import { getAuth } from 'firebase-admin/auth';
import { getStorage } from 'firebase-admin/storage';

let firebaseAdminApp: App | null = null;
let adminAuth: any = null;
let adminStorage: any = null;

export async function getFirebaseAdminApp(): Promise<App | null> {
  if (firebaseAdminApp) {
    return firebaseAdminApp;
  }

  // Only initialize if we have environment variables
  if (
    !process.env.FIREBASE_PROJECT_ID ||
    !process.env.FIREBASE_CLIENT_EMAIL ||
    !process.env.FIREBASE_PRIVATE_KEY
  ) {
    console.warn('Firebase Admin SDK: Missing environment variables');
    return null;
  }

  try {
    const firebaseConfig = {
      credential: cert({
        projectId: process.env.FIREBASE_PROJECT_ID,
        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,
        privateKey: process.env.FIREBASE_PRIVATE_KEY.replace(/\\n/g, '\n'),
      }),
    };

    if (getApps().length === 0) {
      firebaseAdminApp = initializeApp(firebaseConfig);
    } else {
      firebaseAdminApp = getApps()[0];
    }
    
    // Initialize auth and storage
    adminAuth = getAuth(firebaseAdminApp);
    adminStorage = getStorage(firebaseAdminApp);
    
    return firebaseAdminApp;
  } catch (error) {
    console.error('Firebase Admin SDK initialization error:', error.message);
    return null;
  }
}

// Export auth and storage
export { adminAuth, adminStorage };

// For server-side usage only
export function isFirebaseAvailable(): boolean {
  return !!(
    process.env.FIREBASE_PROJECT_ID &&
    process.env.FIREBASE_CLIENT_EMAIL &&
    process.env.FIREBASE_PRIVATE_KEY
  );
}
# Update firebase-admin helper
nano src/lib/firebase-admin.ts  # Use your preferred editor
# Add the exports as shown above
